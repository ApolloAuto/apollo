"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[988],{80970:(e,t,n)=>{n.r(t),n.d(t,{default:()=>an});var r=n(40366),o=n.n(r),i=n(97780);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return(t=function(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var m=(0,r.createContext)(void 0),p=function(e){var t=e.initialPath,n=void 0===t?"/":t,i=e.children,a=s((0,r.useState)(n),2),l=a[0],u=a[1],c=(0,r.useMemo)((function(){return{currentPath:l,navigate:u}}),[l]);return o().createElement(m.Provider,{value:c},i)},d=function(e){var t=e.path,n=e.children,i=(0,r.useContext)(m);if(!i)throw new Error("Route must be used within SimpleRouter");return i.currentPath===t?o().createElement(o().Fragment,null,n):null},v=function(){var e=(0,r.useContext)(m);if(!e)throw new Error("useNavigate must be used within SimpleRouter");return e.navigate},y=function(e){var t=e.path,n=e.style,i=e.children,a=(0,r.useContext)(m);if(!a)throw new Error("KeepAlive must be used within SimpleRouter");var l=a.currentPath===t,c=s((0,r.useState)(!1),2),f=c[0],p=c[1];return(0,r.useEffect)((function(){l&&p(!0)}),[l]),f?o().createElement("div",{style:u(u({},n),{},{display:l?"block":"none"})},i):null},b=n(36242),g=n(46533),h=n(47960),E=n(33005),O=n.n(E),w=n(10939),C=n(11446),S=n(38129),P={Perception:{polygon:{defaultVisible:!0,currentVisible:!0,vizKey:"polygon"},boundingbox:{defaultVisible:!1,currentVisible:!1,vizKey:"boundingbox"},pointCloud:{defaultVisible:!1,currentVisible:!1,vizKey:"pointCloud"},curbPointCloud:{defaultVisible:!1,currentVisible:!1,vizKey:"curbPointCloud"},unknownMovable:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownMovable"},vehicle:{defaultVisible:!0,currentVisible:!0,vizKey:"vehicle"},unknownStationary:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownUnmovable"},pedestrian:{defaultVisible:!0,currentVisible:!0,vizKey:"pedestrian"},unknown:{defaultVisible:!0,currentVisible:!0,vizKey:"unknown"},bicycle:{defaultVisible:!0,currentVisible:!0,vizKey:"bicycle"},cipv:{defaultVisible:!0,currentVisible:!0,vizKey:"cipv"},velocity:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleVelocity"},heading:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleHeading"},id:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleId"},distanceAndSpeed:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDistanceAndSpeed"},laneMarker:{defaultVisible:!1,currentVisible:!1,vizKey:"laneMarker"},lidarSensor:{defaultVisible:!1,currentVisible:!1,vizKey:"lidarSensor"},radarSensor:{defaultVisible:!1,currentVisible:!1,vizKey:"radarSensor"},cameraSensor:{defaultVisible:!1,currentVisible:!1,vizKey:"cameraSensor"},v2x:{defaultVisible:!1,currentVisible:!1,vizKey:"v2x"}},Prediction:{priority:{defaultVisible:!0,currentVisible:!0,vizKey:"obstaclePriority"},majorPredictionLine:{defaultVisible:!0,currentVisible:!0,vizKey:"majorPredictionLine"},gaussianInfo:{defaultVisible:!1,currentVisible:!1,vizKey:"gaussianInfo"},minorPredictionLine:{defaultVisible:!0,currentVisible:!0,vizKey:"minorPredictionLine"},interactiveTag:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleInteractiveTag"}},Routing:{routingLine:{defaultVisible:!0,currentVisible:!0,vizKey:"routingLine"}},Decision:{mainDecision:{defaultVisible:!0,currentVisible:!0,vizKey:"mainDecision"},obstacleDecision:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDecision"}},Planning:{planningCar:{defaultVisible:!1,currentVisible:!1,vizKey:"planningCar"},planningTrajectoryLine:{defaultVisible:!0,currentVisible:!0,vizKey:"planningTrajectoryLine"},planningReferenceLine:{defaultVisible:!1,currentVisible:!1,vizKey:"PlanningReferenceLine"},planningBoundaryLine:{defaultVisible:!1,currentVisible:!1,vizKey:"PlanningBoundaryLine"}},Position:{localization:{defaultVisible:!0,currentVisible:!0,vizKey:"localization"},gps:{defaultVisible:!1,currentVisible:!1,vizKey:"gps"},shadow:{defaultVisible:!1,currentVisible:!1,vizKey:"shadow"}},Map:{crosswalk:{defaultVisible:!0,currentVisible:!0,vizKey:"crosswalk"},clearArea:{defaultVisible:!0,currentVisible:!0,vizKey:"clearArea"},junction:{defaultVisible:!1,currentVisible:!1,vizKey:"junction"},pncJunction:{defaultVisible:!1,currentVisible:!1,vizKey:"pncJunction"},lane:{defaultVisible:!0,currentVisible:!0,vizKey:"lane"},road:{defaultVisible:!1,currentVisible:!1,vizKey:"road"},signal:{defaultVisible:!0,currentVisible:!0,vizKey:"signal"},stopSign:{defaultVisible:!0,currentVisible:!0,vizKey:"stopSign"},yieldSign:{defaultVisible:!0,currentVisible:!0,vizKey:"yieldSign"},speedBump:{defaultVisible:!0,currentVisible:!0,vizKey:"speedBump"},parkingSpace:{defaultVisible:!0,currentVisible:!0,vizKey:"parkingSpace"},barrierGate:{defaultVisible:!0,currentVisible:!0,vizKey:"barrierGate"},area:{defaultVisible:!0,currentVisible:!0,vizKey:"area"},parkingSpaceId:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpaceId"},laneId:{defaultVisible:!1,currentVisible:!1,vizKey:"laneId"},egoBoudingBox:{defaultVisible:!1,currentVisible:!1,vizKey:"boudingBox"}}},A=function(e){var t={};return Object.keys(e).forEach((function(n){var r=e[n];Object.keys(r).forEach((function(e){var o=r[e];t[n]=t[n]||{},t[n][o.vizKey]=o.currentVisible}))})),t},k=new C.DT(C.qK.layerMenuParams),x=function(){var e=k.get();return e&&Object.keys(e).forEach((function(t){var n=e[t];n.pointCloud=n.pointCloud||e.Perception.pointCloud,n.curbPointCloud=n.curbPointCloud||e.Perception.curbPointCloud})),e||P},I=n(83517),N=n(84436),j=n(1434),R=function(e){return"".concat(e,"-viz-pointcloud-channel")},F=function(e){return"".concat(e,"-viz-curbpointcloud-channel")};function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){V(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function V(e,t,n){return(t=function(e){var t=function(e){if("object"!=L(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==L(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return _(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function z(e){var t,n,a=(0,S.A)(),l=a.classes,u=a.cx,c=e.carviz,s=e.pointCloudFusionChannel,f=e.handlePointCloudVisible,m=e.pointcloudChannels,p=e.updatePointcloudChannel,d=e.getCurChannel,v=e.setCurChannel,y=e.handleReferenceLineVisible,b=e.handleBoundaryLineVisible,E=e.handleTrajectoryLineVisible,O=e.handleBoudingBoxVisible,w=(0,h.Bd)("layerMenu").t,L=(0,I.d)().panelId,T=(0,N.A)().metadata,_=(0,r.useCallback)((function(e){if("curbPointCloud"===e){var t,n=null===(t=T.find((function(e){return e.dataName===g.lt.POINT_CLOUD})))||void 0===t?void 0:t.channels;if(Array.isArray(n))return!n.some((function(e){return e.channelName.includes("/apollo/perception/edge")}))}return!1}),[T]),z=x();k.set(z),c.option.updateLayerOption(A(z),"vehicle");var B=D((0,r.useState)(z),2),K=B[0],W=B[1],U=D((0,r.useState)(Object.keys(K)),1)[0],H=D((0,r.useState)(U[0]),2),Y=H[0],Z=H[1],$=D((0,r.useState)(K[Y]),2),G=$[0],q=$[1],J=(0,r.useRef)(),X=(0,r.useRef)(),Q=(0,C.Mj)(R(L)),ee=(0,C.Mj)(F(L)),te=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pointCloud";v(e,t),p(e,t),"pointCloud"===t?Q.set(e):ee.set(e)},ne=(0,r.useMemo)((function(){var e=(K[Y].pointCloud||{}).currentVisible;return J.current=e,o().createElement("li",{className:l["layer-menu-content-right-li"],key:"pointCloud"},o().createElement("span",{className:l["layer-menu-content-right-switch"]},o().createElement(i.Sc,{checked:e,defaultChecked:e,onChange:function(e){var t=e.target.checked;J.current=t;var n=Object.keys(K).reduce((function(e,n){return e[n]=K[n],e[n].pointCloud=e[n].pointCloud||K.Perception.pointCloud,e[n].pointCloud.currentVisible=t,e}),{}),r=n[Y];q((function(){return r})),W((function(){return n})),c.option.updateLayerOption(A(n),"vehicle"),k.set(n),t&&f&&f(e.target.checked,"pointCloud"),t||f&&f(e.target.checked,"pointCloud")}})),o().createElement("span",{className:l["layer-menu-content-right-label"]},w("pointCloud")))}),[c.option,_,l,Y,f,K,s,w]),re=(0,r.useMemo)((function(){var e=(K[Y].curbPointCloud||{}).currentVisible;return X.current=e,o().createElement("li",{className:l["layer-menu-content-right-li"],"data-width":"min",key:"pointCloud"},o().createElement("span",{className:l["layer-menu-content-right-switch"]},o().createElement(i.Sc,{checked:e,defaultChecked:e,onChange:function(e){var t=e.target.checked;X.current=t;var n=Object.keys(K).reduce((function(e,n){return e[n]=K[n],e[n].curbPointCloud=e[n].curbPointCloud||K.Perception.pointCloud,e[n].curbPointCloud.currentVisible=t,e}),{}),r=n[Y];q((function(){return r})),W((function(){return n})),c.option.updateLayerOption(A(n),"vehicle"),k.set(n),t&&f&&f(e.target.checked,"curbPointCloud"),t||f&&f(e.target.checked,"curbPointCloud")}})),o().createElement("span",{className:l["layer-menu-content-right-label"]},w("curbPointCloud")))}),[c.option,_,l,Y,f,K,s,w]),oe=(0,r.useCallback)((function(){return o().createElement(o().Fragment,null,ne,o().createElement(j.A,{disabled:!J.current,value:d("pointCloud"),options:m.filter((function(e){return!e.value.includes("/apollo/perception/edge")})),onChange:function(e){return te(e,"pointCloud")}}),o().createElement("div",{className:l["layer-menu-horizontal-line"]}))}),[l,d,te,ne,m]),ie=(0,r.useCallback)((function(){return o().createElement(o().Fragment,null,re,o().createElement(j.A,{disabled:!X.current,value:d("curbPointCloud"),options:m.filter((function(e){return e.value.includes("/apollo/perception/edge")})),onChange:function(e){return te(e,"curbPointCloud")}}),o().createElement("div",{className:l["layer-menu-horizontal-line"]}))}),[l,d,te,re,m]);return o().createElement("div",{className:l["layer-menu-container"]},o().createElement("div",{className:l["layer-menu-header"]},o().createElement("div",{className:l["layer-menu-header-left"]},w("layerMenu")),o().createElement("div",{className:l["layer-menu-header-right"]},o().createElement("div",{className:l["layer-menu-header-reset-btn"],onClick:function(){W((function(){return P})),c.option.updateLayerOption(A(P),"vehicle"),k.set(P)}},w("restoreDefaultSettings")))),o().createElement("div",{className:l["layer-menu-content"]},o().createElement("div",{className:l["layer-menu-content-left"]},U.map((function(e){return o().createElement("li",{key:e,className:u(l["layer-menu-content-left-li"],V({},l["li-active"],Y===e)),onClick:function(){Z(e),q(K[e])}},o().createElement("span",null,w(e)))}))),o().createElement("div",{className:l["layer-menu-content-right"]},"Perception"===Y&&o().createElement(o().Fragment,null,o().createElement("li",{className:l["layer-menu-content-right-li"]},o().createElement("span",{className:l["layer-menu-content-right-switch"]},o().createElement(i.sx,{checked:null==K||null===(t=K.Perception)||void 0===t||null===(t=t.polygon)||void 0===t?void 0:t.currentVisible,onChange:function(e){if(e.target.checked){var t=M(M({},K.Perception),{},{polygon:M(M({},K.Perception.polygon),{},{currentVisible:!0}),boundingbox:M(M({},K.Perception.boundingbox),{},{currentVisible:!1})}),n=M(M({},K),{},V({},Y,t));q((function(){return t})),W((function(){return n})),c.option.updateLayerOption(A(n),"vehicle"),k.set(n)}}})),o().createElement("span",{className:l["layer-menu-content-right-label"]},w("polygon"))),o().createElement("li",{className:l["layer-menu-content-right-li"]},o().createElement("span",{className:l["layer-menu-content-right-switch"]},o().createElement(i.sx,{checked:null==K||null===(n=K.Perception)||void 0===n||null===(n=n.boundingbox)||void 0===n?void 0:n.currentVisible,onChange:function(e){if(e.target.checked){var t=M(M({},K.Perception),{},{polygon:M(M({},K.Perception.polygon),{},{currentVisible:!1}),boundingbox:M(M({},K.Perception.boundingbox),{},{currentVisible:!0})}),n=M(M({},K),{},V({},Y,t));q((function(){return t})),W((function(){return n})),c.option.updateLayerOption(A(n),"vehicle"),k.set(n)}}})),o().createElement("span",{className:l["layer-menu-content-right-label"]},w("boundingbox"))),o().createElement("div",{className:l["layer-menu-horizontal-line"]})),oe(),ie(),Object.keys(G).map((function(e){if("pointCloud"===e||"curbPointCloud"===e)return null;var t=(K[Y][e]||{}).currentVisible;return"polygon"!==e&&"boundingbox"!==e&&o().createElement("li",{className:l["layer-menu-content-right-li"],"data-width":"minMax",key:e},o().createElement("span",{className:l["layer-menu-content-right-switch"]},o().createElement(i.Sc,{checked:t,disabled:_(e),defaultChecked:t,onChange:function(t){var n=t.target.checked,r=M(M({},K[Y]),{},V({},e,M(M({},K[Y][e]),{},{currentVisible:n}))),o=M(M({},K),{},V({},Y,r));q((function(){return r})),W((function(){return o})),c.option.updateLayerOption(A(o),"vehicle"),k.set(o),n&&"pointCloud"===e&&!_(e)&&s&&f&&f(t.target.checked),n||"pointCloud"!==e&&"curbPointCloud"!==e||f&&f(t.target.checked,e),"planningReferenceLine"===e&&y(n),"planningBoundaryLine"===e&&b(n),"planningTrajectoryLine"===e&&E(n),"egoBoudingBox"===e&&O(n)}})),o().createElement("span",{className:l["layer-menu-content-right-label"]},w(e)))})))))}const B=o().memo(z);var K=n(96676),W=n(2975),U=n(60346),H=n(66639),Y=n(12391);function Z(e){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(e)}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e,t,n){return(t=function(e){var t=function(e){if("object"!=Z(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Z(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const J=(0,Y.makeStyles)((function(e){return{"routing-editing-op-area":G({width:192,height:32,color:"#A6B5CC",borderRadius:6,position:"absolute",top:24,left:24},e.util.flex("row","space-between","center")),"routing-editing-btn":G(G({width:144,height:32,borderRadius:6,background:"#343C4D"},e.util.flexCenterCenter),{},{"&:hover":{cursor:"pointer",background:"#38465A",color:"#fff"}}),"routing-editing-btn__icon":{marginRight:6},"routing-editing-btn__text":{fontFamily:"PingFangSC-Regular",fontSize:14},"common-routing-editing-btn":G(G({width:32,minWidth:32,height:32,minHeight:32,background:"#343C4D",borderRadius:6},e.util.flexCenterCenter),{},{"&:hover":{cursor:"pointer",background:"#38465A",color:"#fff"}}),"common-routing-editing-btn__icon":{},"routing-editing-disable":{cursor:"not-allowed","& .routing-editing-btn-disable":{color:"#515761",pointerEvents:"none",background:"#383D47"},"& .common-routing-editing-btn-disbale":{color:"#515761",pointerEvents:"none",background:"#383D47"}},"common-routing-popover-ordinary":{"& .dreamview-popover-inner, & .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"}},"common-routing-popover-functional":{"& .dreamview-popover-inner,& .dreamview-popover-arrow::before, & .dreamview-popover-arrow::after":{color:"#A6B5CC !important",background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::before":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(40, 43, 54) !important"}}}}));var X=(0,r.forwardRef)((function(e,t){var n=e.onClick,r=J(),a=r.classes,l=r.cx,u=(0,h.Bd)("routeEditing").t;return o().createElement("div",{id:"routing-editing-btn",className:l(a["routing-editing-btn"],"routing-editing-btn-disable"),onClick:n,ref:t},o().createElement("i",{className:a["routing-editing-btn__icon"]},o().createElement(i.Av,{name:"IcRoutingEditingEnter"})),o().createElement("div",{className:a["routing-editing-btn__text"]},u("routingEditing")))})),Q=(0,r.forwardRef)((function(e,t){var n=e.onClick,r=J(),a=r.classes,l=r.cx;return o().createElement("div",{className:l(a["common-routing-editing-btn"],"common-routing-editing-btn-disbale"),onClick:n,ref:t},o().createElement("i",{className:a["common-routing-editing-btn__icon"]},o().createElement(i.Av,{name:"IcCommonRoutin"})))}));X.displayName="RoutingEditingBtn",Q.displayName="CommonRoutingEditingBtn";var ee=n(43158);const te=(0,Y.makeStyles)((function(e){return{"routing-modal":{"& .dreamview-modal-wrap":{zIndex:"1040"},"& .dreamview-modal-mask":{zIndex:"1040"},"& .dreamview-modal-content":{width:"492px","& .dreamview-modal-body":{marginTop:"30px",label:{color:"#FFFFFF",fontFamily:"PingFangSC-Regular",fontWeight:"400"},"& .dreamview-form":{"& .ant-form-item":{marginBottom:"16px"},"& > div:nth-of-type(1)":{"& .ant-form-item-label":{"& label":{position:"relative",top:"4px"}}}}}},"& .dreamview-modal-footer":{display:"flex",justifyContent:"center",alignItems:"center","& > button":{width:"74px",height:"40px",borderRadius:"8px"},"& > button:nth-of-type(1)":{color:"#FFFFFF",background:"#282B36",border:"1px solid rgba(124,136,153,1)"},"& > button:nth-of-type(2)":{background:"#3288FA",borderRadius:"8px",marginLeft:"24px !important"}}},"routing-form-initial":{fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400",color:"#FFFFFF",marginLeft:"39px",marginBottom:"16px",display:"flex"},"routing-form-initial-content":{width:"320px",color:"#FFFFFF",display:"flex",justifyContent:"space-between"},"routing-form-initial-content-heading":{width:"111px"},"routing-form-way":{height:"264px",border:"1px solid rgba(56,59,69,1)",borderRadius:"8px",padding:"16px 0px 16px 45px",marginBottom:"12px"},"routing-form-way-con":{fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400",color:"#FFFFFF",display:"flex"},"routing-form-way-content":{flex:"1"},"routing-form-way-item":{color:"#FFFFFF",marginBottom:"8px",display:"flex",justifyContent:"space-between"},"routing-form-way-item-heading":{width:"111px"},"routing-form-colon":{color:"#A6B5CC",marginRight:"6px"},"routing-form-colon-distance":{marginLeft:"2px"},"routing-form-loop-disable":{background:"rgb(40, 93, 164)","& .dreamview-switch-handle":{background:"rgb(190, 206, 227)",borderRadius:"3px"}},"create-modal-form":{"& .ant-form-item-label":{"& label":{color:"#A6B5CC !important"}}}}}));var ne=n(27878),re=n(91363);function oe(e){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(e)}function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){le(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function le(e,t,n){return(t=function(e){var t=function(e){if("object"!=oe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==oe(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||ce(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(e,t){if(e){if("string"==typeof e)return se(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?se(e,t):void 0}}function se(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function fe(e){var t,n=e.EE,a=e.destroy,l=e.mainApi,u=e.panelContext,c=e.routeManager,s=e.routingEditor,f=e.isMainConnected,m=e.defaultRoutingList,p=e.createCommonRoutingSuccessFunctional,d=ue(i.lV.useForm(),1)[0],v=te(),y=(v.cx,v.classes),b=(0,h.Bd)("routeEditing").t,E=c.currentRouteMix,O=E.getCurrentRouteMix().currentRouteLoop.currentRouteLoopState,w=null===(t=E.getCurrentRouteMix().currentRouteLoop)||void 0===t?void 0:t.currentRouteLoopTimes,C=ue((0,r.useState)([]),2),S=C[0],P=C[1],A=ue((0,r.useState)({x:0,y:0}),2),k=A[0],x=A[1];return(0,r.useEffect)((function(){var e=s.initiationMarker.initiationMarkerPosition,t=s.pathwayMarker.pathWatMarkerPosition;e?x(e):l.getStartPoint().then((function(e){x({x:e.x,y:e.y,heading:null==e?void 0:e.heading})})),P(t)}),[f]),o().createElement(i.aF,{title:b("routeCreateCommonBtn"),okText:b("create"),cancelText:b("cancel"),open:!0,onOk:function(){d.validateFields().then((function(){if(f&&l){var e=d.getFieldsValue();if(e.loopRouting){var t=Number(e.cycleNumber);e.cycleNumber=t>10?10:t}delete e.loopRouting,l.saveDefaultRouting(ae(ae({},e),{},{routingType:g.D5.DEFAULT_ROUTING,point:[k].concat((r=S,function(e){if(Array.isArray(e))return se(e)}(r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||ce(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))})).then((function(){n.emit(re.u.SimControlRoute,{panelId:u.panelId,routeInfo:{initialPoint:k,wayPoint:S,cycleNumber:null==e?void 0:e.cycleNumber}}),p(),a(),(0,i.iU)({type:"success",content:b("createCommonRouteSuccess")})}))}var r}))},onCancel:function(){a()},rootClassName:y["routing-modal"]},o().createElement(i.lV,{form:d,name:"form",className:y["create-modal-form"],initialValues:{loopRouting:O,cycleNumber:w}},o().createElement(i.lV.Item,{label:b("name"),style:{marginLeft:"74px"},name:"name",rules:[function(e){return e.getFieldValue,{validator:function(e,t){return t?t&&m.find((function(e){return e.name===t}))?Promise.reject(new Error(b("alreadyExists"))):Promise.resolve():Promise.reject(new Error(b("pleaseEnter")))}}}]},o().createElement(i.pd,{placeholder:"Please enter",style:{width:"252px",height:"40px"}})),o().createElement("div",{className:y["routing-form-initial"]},o().createElement("div",{className:y["routing-form-colon"]},b("initialPoint"),o().createElement("span",{className:y["routing-form-colon-distance"]},":")),o().createElement("div",{className:y["routing-form-initial-content"]},o().createElement("div",null,"[".concat(k.x.toFixed(3)," ，").concat(k.y.toFixed(3),"]")),o().createElement("div",{className:y["routing-form-initial-content-heading"]},null!=k&&k.heading?k.heading.toFixed(3):"-"))),o().createElement(ne.A,{className:y["routing-form-way"]},o().createElement("div",{className:y["routing-form-way-con"]},o().createElement("div",{className:y["routing-form-colon"]},b("wayPoint"),o().createElement("span",{className:y["routing-form-colon-distance"]},":")),o().createElement("div",{className:y["routing-form-way-content"]},null==S?void 0:S.map((function(e,t){return o().createElement("div",{key:"".concat(e.x).concat(e.y).concat(t+1),className:y["routing-form-way-item"]},o().createElement("div",null,"[".concat(e.x.toFixed(3),"，").concat(e.y.toFixed(3),"]")),o().createElement("div",{className:y["routing-form-way-item-heading"]},null!=e&&e.heading?e.heading.toFixed(3):"-"))}))))),O&&o().createElement(i.lV.Item,{label:b("loopRouting"),style:{marginLeft:"16px"},name:"loopRouting",valuePropName:"checked"},o().createElement(i.dO,{disabled:!0,className:y["routing-form-loop-disable"]})),O&&o().createElement(i.lV.Item,{label:b("setLooptimes"),style:{marginLeft:"11px"},name:"cycleNumber",rules:[function(e){return e.getFieldValue,{validator:function(e,t){return t?Number(t)>10?Promise.reject(new Error("Max loop times is 10")):Promise.resolve():Promise.reject(new Error("Please enter"))}}}]},o().createElement(i.YI,{type:"number",max:10,precision:0,disabled:!0}))))}var me=function(e){return e.EDITING_ROUTE="editing",e.CREATING_ROUTE="creating",e}({}),pe=function(e){return e.INITIAL_POINT="initial_point",e.WAY_POINT="way_point",e.INDOOR_LOCALIZATION_POINT="indoor_localization_point",e}({}),de=n(29946),ve=n(47127),ye="INIT_ROUTING_EDITOR",be="INIT_ROUTE_MANAGER",ge=de.$7.createStoreProvider({initialState:{routingEditor:null,routeManager:null},reducer:function(e,t){return(0,ve.jM)(e,(function(e){switch(t.type){case ye:e.routingEditor=t.payload.routingEditor;break;case be:e.routeManager=t.payload.routeManager}}))}}),he=ge.StoreProvider,Ee=ge.useStore;const Oe=(0,Y.makeStyles)((function(){return{"favorite-scroll":{width:"284px",maxHeight:"402px",padding:"16px 16px"},"favorite-creating-op":{width:"252px",height:"40px",marginBottom:"10px"},"favorite-common-co":{"& > div:last-child":{borderBottom:"none"}},"favorite-common-item":{height:"40px",color:"#A6B5CC",fontSize:"14px",fontWeight:"400",fontFamily:"PingFangSC-Regular",borderBottom:"1px solid #383B45",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center","& .favorite-common-item-op-hover":{display:"none"},"&:hover":{width:"268px",background:"rgba(115,193,250,0.08)",borderRadius:"6px",margin:"0px -8px 0px -8px",padding:"0px 8px 0px 8px","& .favorite-common-item-op-no-hover":{display:"none"},"& .favorite-common-item-op-hover":{display:"block"}}},"favorite-common-item-active":{background:"#3288FA !important",borderRadius:"6px",margin:"0px -8px 0px -8px",padding:"0px 8px 0px 8px","& .favorite-common-item-name-cx":{color:"#FFFFFF"},"& .favorite-common-item-op-no-hover-val-cx":{background:"#3288FA"},"& .favorite-common-item-op-no-hover-title-cx":{color:"#FFFFFF !important"},"&: hover":{"& .favorite-common-item-op-hover":{display:"none"},"& .favorite-common-item-op-no-hover":{display:"block"}}},"favorite-common-item-op-no-hover-title":{color:"#808B9D"},"favorite-common-item-op-no-hover-val":{width:"18px",height:"18px",color:"#FFFFFF",fontSize:"12px",textAlign:"center",lineHeight:"18px",marginLeft:"4px",background:"#343C4D",borderRadius:"4px",display:"inline-block"},"favorite-common-item-op-hover-remove":{color:"#FFFFFF",marginLeft:"23px"},"favorite-common-item-name":{width:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},"favorite-warning-co":{padding:"14px 0px 32px 0px",display:"flex",flexDirection:"column",alignItems:"center"},"favorite-warning-co-desc":{width:"195px",color:"#A6B5CC",fontSize:"12px",fontWeight:"400",fontFamily:"PingFangSC-Regular"},"favorite-warning-co-desc-active":{color:"#3288FA",cursor:"pointer"}}}));var we=n(27470),Ce=n(1465);function Se(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||Pe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pe(e,t){if(e){if("string"==typeof e)return Ae(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ae(e,t):void 0}}function Ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ke(e){var t=e.activeOrigin,n=e.destroyFunFavoriteNotFullScreen,a=Oe(),l=a.cx,u=a.classes,c=(0,i.XE)("ic_default_page_no_data"),s=(0,Ce.ml)(),f=v(),m=(0,I.d)(),p=m.enterFullScreen,d=(0,h.Bd)("routeEditing").t,y=Se(Ee(),1)[0],b=y.routeManager,g=y.routingEditor,E=b.currentRouteManager,O=(0,N.A)(),w=O.mainApi,C=O.isMainConnected,S=Se((0,r.useState)(null),2),P=S[0],A=S[1],k=Se((0,r.useState)([]),2),x=k[0],j=k[1],R=function(){C&&w.getDefaultRoutings().then((function(e){j(e.defaultRoutings.reverse())}))},F=(0,r.useCallback)((function(){t===we.uW.FROM_FULLSCREEN&&(g.pathwayMarker.positionsCount&&C?(0,ee.A)({EE:s,mainApi:w,routeManager:b,routingEditor:g,panelContext:m,isMainConnected:C,defaultRoutingList:x,createCommonRoutingSuccessFunctional:R},fe):(0,i.iU)({type:"error",content:d("NoWayPointMessage")})),t===we.uW.FROM_NOT_FULLSCREEN&&(n(),f("/routing"),p())}),[s,w,x,b,g,m,t,b,C,f,p]);return(0,r.useEffect)((function(){C&&w.getDefaultRoutings().then((function(e){j(e.defaultRoutings.reverse())}))}),[C]),(0,r.useEffect)((function(){var e,t,n,r,o,i;A((e=x,t=E.getCurrentRoute(),o=[null==t||null===(n=t.routePoint)||void 0===n?void 0:n.routeInitialPoint].concat(function(e){if(Array.isArray(e))return Ae(e)}(i=(null==t||null===(r=t.routePoint)||void 0===r?void 0:r.routeWayPoint)||[])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(i)||Pe(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),e.find((function(e){return e.point.length===o.length&&e.point.every((function(e,t){var n,r,i;return(null==e?void 0:e.heading)===(null===(n=o[t])||void 0===n?void 0:n.heading)&&e.x===(null===(r=o[t])||void 0===r?void 0:r.x)&&e.y===(null===(i=o[t])||void 0===i?void 0:i.y)}))}))))}),[x]),o().createElement(ne.A,{className:u["favorite-scroll"]},t!==we.uW.FROM_NOT_FULLSCREEN&&o().createElement(i.$n,{className:u["favorite-creating-op"],onClick:F},d("routeCreateCommonBtn")),x.length?o().createElement("div",{className:u["favorite-common-co"]},x.map((function(e){return o().createElement("div",{key:e.name,onClick:function(){return function(e){A(e);var t=m.panelId,n=e.point[0],r=e.point.slice(1),o=null==e?void 0:e.cycleNumber,i={initialPoint:n,wayPoint:r,cycleNumber:o};b.currentRouteMix.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!0,currentRouteLoopTimes:o}}),w.setStartPoint({point:n}).then((function(){E.setCurrentRoute({routeOrigin:me.CREATING_ROUTE,routePoint:{routeInitialPoint:n,routeWayPoint:r}}),s.emit(re.u.SimControlRoute,{panelId:t,routeInfo:i})}))}(e)},className:l(u["favorite-common-item"],P&&P.name===e.name&&u["favorite-common-item-active"])},o().createElement("div",{className:l("favorite-common-item-name-cx",u["favorite-common-item-name"]),title:e.name},e.name),e.cycleNumber&&o().createElement("div",{className:l("favorite-common-item-op-no-hover")},o().createElement("span",{className:l("favorite-common-item-op-no-hover-title-cx",u["favorite-common-item-op-no-hover-title"])},d("looptimes")),o().createElement("span",{className:l("favorite-common-item-op-no-hover-val-cx",u["favorite-common-item-op-no-hover-val"])},e.cycleNumber)),o().createElement("div",{className:l("favorite-common-item-op-hover")},o().createElement("span",{onClick:(t=e.name,function(e){e.stopPropagation(),C&&w.deleteDefaultRouting(t).then((function(){w.getDefaultRoutings().then((function(e){j(e.defaultRoutings.reverse())}))}))}),className:l("favorite-common-item-op-hover-remove-cx",u["favorite-common-item-op-hover-remove"])},o().createElement(i.Av,{name:"IcRemoveAllPoints"}))));var t}))):o().createElement("div",{className:u["favorite-warning-co"]},o().createElement("img",{src:c,alt:"resource_empty"}),o().createElement("div",{className:u["favorite-warning-co-desc"]},"".concat(d("createRouteToolTip"),","),o().createElement("span",{className:u["favorite-warning-co-desc-active"],onClick:F},d("goToCreate")))))}const xe=o().memo(ke);function Ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ne(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ne(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function je(){var e=J(),t=e.classes,n=e.cx,a=v(),l=Ie((0,b.qZ)(),1)[0],u=(0,I.d)().enterFullScreen,c=(0,h.Bd)("routeEditing").t,s={popoverDisableText:c("routeEditingBtnOther")},f=Ie((0,r.useState)(!1),2),m=f[0],p=f[1],d=Ie((0,r.useState)(!1),2),y=d[0],g=d[1],E=Ie((0,r.useState)(!0),2),O=E[0],w=E[1],C=o().createElement(xe,{activeOrigin:we.uW.FROM_NOT_FULLSCREEN,destroyFunFavoriteNotFullScreen:function(){g(!1)}}),S=(0,r.useCallback)((function(){u(),setTimeout((function(){a("/routing")})),(0,H.rv)({dv_viz_func_name:"Route Editing"})}),[u,a]);return(0,r.useEffect)((function(){l.currentOperation===b.D8.PLAY_RECORDER||l.currentOperation===b.D8.SCENARIO||l.currentOperation===b.D8.SIM_CONTROL||l.currentOperation===b.D8.AUTO_DRIVE?w(!1):w(!0)}),[l]),o().createElement("div",{className:n(O&&t["routing-editing-disable"],t["routing-editing-op-area"])},O?o().createElement(o().Fragment,null,o().createElement(i.AM,{content:null==s?void 0:s.popoverDisableText,trigger:"hover",placement:"top"},o().createElement(o().Fragment,null,o().createElement(X,{onClick:S}))),o().createElement(i.AM,{content:null==s?void 0:s.popoverDisableText,trigger:"hover",placement:"top"},o().createElement(o().Fragment,null,o().createElement(Q,null)))):o().createElement(o().Fragment,null,o().createElement(X,{onClick:S}),o().createElement(i.AM,{content:c("routeCreateCommonBtn"),trigger:"hover",placement:"top",open:m,onOpenChange:function(e){p(e),g(!1)}},o().createElement(i.AM,{content:C,trigger:"click",placement:"rightTop",open:y,onOpenChange:function(e){p(!1),g(e),(0,H.rv)({dv_viz_func_name:"Common Routing"})},destroyTooltipOnHide:!0},o().createElement(o().Fragment,null,o().createElement(Q,null))))))}var Re=n(4611),Fe=n(75508),Le=function(e){return e.DEFAULT="Default",e.OVERHEAD="Overhead",e.MAP="Map",e.NEAR="Near",e.TOP_DOWN="TopDown",e}({}),Te=function(e){return e.DEFAULT="Default",e.FOLLOW="Follow",e}({});function Me(e){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Me(e)}function Ve(){return Ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ve.apply(null,arguments)}function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(Object(n),!0).forEach((function(t){ze(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ze(e,t,n){return(t=function(e){var t=function(e){if("object"!=Me(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Me(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Me(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Be=(0,Y.makeStyles)((function(e){return{"custom-popover":{"&.dreamview-popover .dreamview-popover-inner":{padding:0},"& .dreamview-popover-inner, & .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8)"},"& .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8)"},"& .dreamview-popover-content .dreamview-popover-inner .dreamview-popover-inner-content":_e({},e.tokens.typography.content)}}}));function Ke(e){var t=Be(),n=t.classes;return t.cx,o().createElement(i.AM,Ve({},e,{rootClassName:"".concat(n["custom-popover"]," ").concat(e.rootClassName||"")}))}const We=o().memo(Ke);function Ue(e){return Ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ue(e)}function He(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?He(Object(n),!0).forEach((function(t){Ze(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):He(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ze(e,t,n){return(t=function(e){var t=function(e){if("object"!=Ue(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ue(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ue(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const $e=(0,Y.makeStyles)((function(e){return{"routing-editing-function-area":Ye({width:40,position:"absolute",top:25,left:24,color:""},e.util.flex("column","space-around","center")),"routing-editing-function-area__group":{background:e.components.layerMenu.menuItemBg,borderRadius:6,marginBottom:10},"routing-editing-functional__item":Ye(Ye({width:40,minWidth:40,height:40,minHeight:40,background:e.components.layerMenu.menuItemBg,borderRadius:6,color:e.components.layerMenu.menuItemColor},e.util.flexCenterCenter),{},{"&:hover":{cursor:"pointer",background:e.components.layerMenu.menuItemBg}}),"hover-color-change":{"&:hover":{color:e.components.layerMenu.menuItemHoverColor}},"routing-editing-functional__item--active":{color:"#3388FA"},"routing-editing-functional__icon":{fontSize:20},"custom-popover-ordinary":{"& .dreamview-popover-inner, & .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"}},"custom-popover-functinal":{"& .dreamview-popover-inner,& .dreamview-popover-arrow::before, & .dreamview-popover-arrow::after":{color:"#A6B5CC !important",background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::before":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(40, 43, 54) !important"}},"routing-editing-functional__item--disable":{cursor:"not-allowed","&:hover":{cursor:"not-allowed"}}}}));function Ge(e){return Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ge(e)}function qe(e,t,n){return(t=function(e){var t=function(e){if("object"!=Ge(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ge(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ge(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Je(e,t){var n=e.functionalName,a=e.checkedItem,l=e.onClick,u=e.disable,c=(0,r.useMemo)((function(){return a===n}),[n,a]),s=$e({}),f=s.classes,m=s.cx,p=(0,r.useMemo)((function(){switch(n){case we.Ay.RELOCATE:return o().createElement("i",null,o().createElement(i.Av,{name:"IcLocation"}));case we.Ay.WAYPOINT:return o().createElement("i",null,o().createElement(i.Av,{name:"IcWayPoint"}));case we.Ay.LOOP:return o().createElement("i",null,o().createElement(i.Av,{name:"IcLoopRouting"}));case we.Ay.FAVORITE:return o().createElement("i",null,o().createElement(i.Av,{name:"IcCommonRoutin"}));case we.Ay.INDOOR_LOCALIZATION:return o().createElement("i",null,o().createElement(i.Av,{name:"IcIndoorIocation"}));default:return null}}),[n]);return o().createElement("div",{ref:t,className:m(f["routing-editing-functional__item"],qe(qe(qe({},f["routing-editing-functional__item--active"],c),f["hover-color-change"],!c),f["routing-editing-functional__item--disable"],u)),onClick:u?function(){return null}:l},o().createElement("div",{className:f["routing-editing-functional__icon"]},p))}const Xe=(0,r.forwardRef)(Je);var Qe=function(e){return e.FunctionalRelocateNoActive="initialPoint",e.FunctionalRelocateNoActiveDis="Inial Point is only available for simulation",e.FunctionaWayNoActive="wayPoint",e.FunctionalLoopNoActive="loopRouting",e.FunctionalFavoriteNoActive="commonRouting",e.FunctionalIndoorLocationNoActive="Indoor Location",e.FunctionalIndoorLocationNoActiveDis='Indoor location is only available when the "IndoorLocalization" module is enabled',e}({});const et=(0,Y.makeStyles)((function(e){return{"routing-editing-item-no-active":{padding:"5px 10px",color:"#FFFFFF",fontSize:"14px",fontWeight:"400",fontFamily:"PingFangSC-Regular"}}}));function tt(e){var t=e.functionalItemNoActiveText,n=et(),r=n.classes,i=(n.cx,(0,h.Bd)("routeEditing").t);return o().createElement("div",{className:r["routing-editing-item-no-active"]},i(t))}const nt=(0,Y.makeStyles)((function(e){return{"functional-initial-con":{display:"flex"},"functional-initial-every-icon-con":{cursor:"not-allowed"},"functional-initial-disable":{"& .functional-initial-every-icon-disable":{color:"#40454D",pointerEvents:"none"}},"functional-initial-popover":{"& .dreamview-popover-inner-content":{padding:"5px 10px",color:"#FFFFFF",fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400"}},"functional-initial-every-icon":{width:"32px",height:"32px",color:"#A6B5CC",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#D8D8D8",background:"rgba(115,193,250,0.08)"}}}}));function rt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ot(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ot(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ot(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function it(e){var t=nt(),n=t.classes,a=t.cx,l=rt(Ee(),1)[0].routingEditor,u=(0,h.Bd)("routeEditing").t,c=(0,N.A)(),s=c.isMainConnected,f=c.mainApi,m=rt((0,r.useState)(l.initiationMarker.positionsCount),2),p=m[0],d=m[1],v=rt((0,r.useState)(!(p>0)),2),y=v[0],b=v[1];return(0,r.useEffect)((function(){b(!p)}),[p]),o().createElement("div",{className:a(y&&n["functional-initial-disable"],n["functional-initial-con"])},o().createElement(i.AM,{content:u("backToLastPoint"),trigger:"hover",rootClassName:n["functional-initial-popover"]},o().createElement("div",{className:y&&a(n["functional-initial-every-icon-con"])},o().createElement("div",{className:a("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){var e=l.initiationMarker.undo();s&&(e?f.setStartPoint({point:e}).then((function(){d(l.initiationMarker.positionsCount)})):f.setResetPoint().then((function(){d(l.initiationMarker.positionsCount)})))}},o().createElement(i.Av,{name:"IcBackToAstPoint"})))),o().createElement(i.AM,{content:u("backToStartPoint"),trigger:"hover",rootClassName:n["functional-initial-popover"]},o().createElement("div",{className:y&&a(n["functional-initial-every-icon-con"])},o().createElement("div",{className:a("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){s&&f.setResetPoint().then((function(){l.initiationMarker.reset(),d(l.initiationMarker.positionsCount)}))}},o().createElement(i.Av,{name:"IcBackTheStartingPoint"})))))}const at=(0,Y.makeStyles)((function(e){return{"functional-initial-con":{display:"flex"},"functional-initial-every-icon-con":{cursor:"not-allowed"},"functional-initial-disable":{"& .functional-initial-every-icon-disable":{color:"#40454D",pointerEvents:"none"}},"functional-initial-popover":{"& .dreamview-popover-inner-content":{padding:"5px 10px",color:"#FFFFFF",fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400"}},"functional-initial-every-icon":{width:"32px",height:"32px",color:"#A6B5CC",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#D8D8D8",background:"rgba(115,193,250,0.08)"}}}}));function lt(e){return lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lt(e)}function ut(e,t,n){return(t=function(e){var t=function(e){if("object"!=lt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=lt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==lt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ct(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return st(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?st(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function st(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ft(e){var t=at(),n=t.classes,a=t.cx,l=ct(Ee(),1)[0].routingEditor,u=(0,h.Bd)("routeEditing").t,c=ct((0,r.useState)(l.pathwayMarker.positionsCount),2),s=c[0],f=c[1],m=ct((0,r.useState)(!(s>0)),2),p=m[0],d=m[1];return(0,r.useEffect)((function(){d(!s)}),[s]),o().createElement("div",{className:a(ut({},n["functional-initial-disable"],p),n["functional-initial-con"])},o().createElement(i.AM,{content:u("removeLastPoint"),trigger:"hover",rootClassName:n["functional-initial-popover"]},o().createElement("div",{className:a(ut({},n["functional-initial-every-icon-con"],p))},o().createElement("div",{className:a("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){l.pathwayMarker.undo(),f(l.pathwayMarker.positionsCount)}},o().createElement(i.Av,{name:"IcBackToAstPoint"})))),o().createElement(i.AM,{content:u("removeAllPoints"),trigger:"hover",rootClassName:n["functional-initial-popover"]},o().createElement("div",{className:a(ut({},n["functional-initial-every-icon-con"],p))},o().createElement("div",{className:a("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){l.pathwayMarker.reset(),f(l.pathwayMarker.positionsCount)}},o().createElement(i.Av,{name:"IcRemoveAllPoints"})))))}const mt=(0,Y.makeStyles)((function(){return{"functional-loop-con":{width:"257px",padding:"16px 0px 21px 0px",color:"#A6B5CC",fontSize:"14px",fontWeight:"400",fontFamily:"PingFangSC-Regular"},"functional-loop-switch":{width:"160px",height:"20px",margin:"0px 0px 0px 32px",display:"flex",justifyContent:"space-around",alignItems:"center"},"functional-loop-switch-help":{"& .dreamview-popover-arrow::before":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-inner-content":{width:"302px",color:"#FFFFFF",fontSize:"14px",fontWeight:"400",padding:"5px 10px",borderRadius:"6px",fontFamily:"PingFangSC-Regular",background:"rgba(80, 88, 102, 0.8)"}},"functional-loop-switch-remind":{position:"relative",top:"2px"},"functional-loop-input":{height:"32px",margin:"16px 0px 0px 20px",display:"flex",alignItems:"center"},"functional-loop-input-text":{marginRight:"6px"}}}));function pt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return dt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function vt(e){var t=mt(),n=t.classes,a=(t.cx,pt(Ee(),1)[0].routeManager),l=(0,h.Bd)("routeEditing").t,u=a.currentRouteMix,c=u.getCurrentRouteMix(),s=pt((0,r.useState)(c.currentRouteLoop.currentRouteLoopState),2),f=s[0],m=s[1];return o().createElement("div",{className:n["functional-loop-con"]},o().createElement("div",{className:n["functional-loop-switch"]},o().createElement("div",null,"".concat(l("loopRouting"),":")),o().createElement("div",null,o().createElement(i.dO,{onChange:function(e){e?u.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!0,currentRouteLoopTimes:1}}):u.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!0}}),m(e)},checked:f})),o().createElement(i.AM,{content:l("loopRoutingHelp"),trigger:"hover",placement:"top",rootClassName:n["functional-loop-switch-help"]},o().createElement("div",{className:n["functional-loop-switch-remind"]},o().createElement(i.Av,{name:"IcHelpNormal"})))),f&&o().createElement("div",{className:n["functional-loop-input"]},o().createElement("div",{className:n["functional-loop-input-text"]},"".concat(l("setLooptimes"),":")),o().createElement("div",null,o().createElement(i.YI,{min:1,max:10,precision:0,onChange:function(e){u.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!0,currentRouteLoopTimes:e}})},defaultValue:u.getCurrentRouteMix().currentRouteLoop.currentRouteLoopTimes}))))}function yt(e){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yt(e)}function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach((function(t){ht(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ht(e,t,n){return(t=function(e){var t=function(e){if("object"!=yt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==yt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ot(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ot(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ot(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function wt(e){var t=e.carviz,n=e.changeActiveName,a=e.activeName,l=Et((0,b.qZ)(),1)[0],u=Et(Ee(),1)[0],c=u.routeManager,s=u.routingEditor,f=(0,N.A)(),m=(f.isMainConnected,f.mainApi),p=(0,h.Bd)("routeEditing").t,d=(c.currentRouteMix,Et((0,r.useState)(null),2)),v=d[0],y=d[1],g=l.currentOperation===b.D8.AUTO_DRIVE,E=(0,r.useMemo)((function(){return l.modules.get("IndoorLocalization")}),[l.modules]),O=$e({relocateDisState:g}),w=O.classes,C=O.cx,S=(0,r.useRef)(0),P=(0,r.useCallback)((function(){return(new Date).getTime()-S.current>3e4}),[S]),A=(0,r.useCallback)((function(e,n){var r={routeOrigin:me.EDITING_ROUTE,routePoint:{routeInitialPoint:t.initiationMarker.initiationMarkerPosition,routeWayPoint:t.pathwayMarker.pathWatMarkerPosition}};if(n)if((null==n?void 0:n.origin)!==we.Ay.INDOOR_LOCALIZATION)if("lastPosition"in n){var o,a,l=n.lastPosition;"edit"===e&&(null===(a=c.currentRouteManager)||void 0===a||a.setScribeCurrentCheckPoint(gt(gt({},l),{},{type:pe.WAY_POINT}))),null===(o=c.currentRouteManager)||void 0===o||o.setCurrentRoute(r)}else{var u,s;"edit"===e&&(null===(s=c.currentRouteManager)||void 0===s||s.setScribeCurrentCheckPoint(gt(gt({},n),{},{type:pe.INITIAL_POINT}))),null===(u=c.currentRouteManager)||void 0===u||u.setCurrentRoute(r)}else if("edit"===e){if(!P())return void t.indoorLocalizationMarker.undo();S.current=(new Date).getTime();var f=null==n?void 0:n.lastPosition;(0,i.iU)({type:"loading",content:"The Initialization point has been sent and is waiting for the indoor localization module to complete initialization",key:"sendIndoorLocalizationInitPoint",duration:30}),m.sendIndoorLocalizationInitPoint(f).then((function(){var e=setInterval((function(){new Promise((function(e,t){m.checkIndoorLocalizationInitPointStatus().then((function(){e()})).catch((function(){t()}))})).then((function(){i.iU.destory("sendIndoorLocalizationInitPoint"),clearInterval(e),t.indoorLocalizationMarker.reset(),(0,i.iU)({type:"success",content:"IndoorLocalization Success",key:"checkIndoorLocalizationState"}),null==m||m.getStartPoint().then((function(e){t.initiationMarker.init(e)}))}),(function(){P()&&(clearInterval(e),t.indoorLocalizationMarker.reset(),(0,i.iU)({type:"error",content:"IndoorLocalization Fail",key:"checkIndoorLocalizationState"}))}))}),1e4)})).catch((function(){(0,i.iU)({type:"error",content:"send IndoorLocalization Init Point Fail",key:"sendIndoorLocalizationInitPoint"})}))}}),[t.initiationMarker,t.pathwayMarker,c.currentRouteManager]);(0,r.useEffect)((function(){Object.values(we.e_).includes(a)&&([we.e_.RELOCATE,we.e_.WAYPOINT,we.e_.INDOOR_LOCALIZATION].includes(a)||y(null))}),[a,t]),(0,r.useEffect)((function(){var e=function(e){"r"===e.key&&v!==we.Ay.RELOCATE&&(null==t||t.deactiveAll(),y(we.Ay.RELOCATE),null==n||n(we.e_.RELOCATE),null==t||t.initiationMarker.active(A)),"w"===e.key&&v!==we.Ay.WAYPOINT&&(null==t||t.deactiveAll(),y(we.Ay.WAYPOINT),null==n||n(we.e_.WAYPOINT),null==t||t.pathwayMarker.active(A)),"i"===e.key&&v!==we.Ay.INDOOR_LOCALIZATION&&(null==t||t.deactiveAll(),y(we.Ay.INDOOR_LOCALIZATION),null==n||n(we.e_.INDOOR_LOCALIZATION),null==t||t.indoorLocalizationMarker.active(A)),(e.ctrlKey||e.metaKey)&&"z"===e.key&&(v===we.Ay.RELOCATE&&(null==t||t.initiationMarker.undo()),v===we.Ay.WAYPOINT&&(null==t||t.pathwayMarker.undo()))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[v]);var k=(0,r.useCallback)((function(e){return function(){if(e!==we.Ay.RELOCATE||!g){if(v===e)return Object.values(we.e_).includes(e)&&(null==t||t.deactiveAll()),void y(null);switch(e){case we.Ay.RELOCATE:y(e),null==t||t.deactiveAll(),null==n||n(we.e_.RELOCATE),null==t||t.initiationMarker.active(A);break;case we.Ay.WAYPOINT:y(e),null==t||t.deactiveAll(),null==n||n(we.e_.WAYPOINT),null==t||t.pathwayMarker.active(A);break;case we.Ay.LOOP:s.pathwayMarker.positionsCount>0?(y(e),null==t||t.deactiveAll()):(0,i.iU)({type:"error",content:p("NoWayPointMessage")});break;case we.Ay.FAVORITE:y(e),null==t||t.deactiveAll();break;case we.Ay.INDOOR_LOCALIZATION:y(e),null==t||t.deactiveAll(),null==n||n(we.e_.INDOOR_LOCALIZATION),null==t||t.indoorLocalizationMarker.active(A)}}}}),[t,n,v]),x=v===we.Ay.RELOCATE?o().createElement(it,null):o().createElement(tt,{functionalItemNoActiveText:g?Qe.FunctionalRelocateNoActiveDis:Qe.FunctionalRelocateNoActive}),I=v===we.Ay.WAYPOINT?o().createElement(ft,null):o().createElement(tt,{functionalItemNoActiveText:Qe.FunctionaWayNoActive}),j=v===we.Ay.LOOP?o().createElement(vt,null):o().createElement(tt,{functionalItemNoActiveText:Qe.FunctionalLoopNoActive}),R=v===we.Ay.FAVORITE?o().createElement(xe,{activeOrigin:we.uW.FROM_FULLSCREEN}):o().createElement(tt,{functionalItemNoActiveText:Qe.FunctionalFavoriteNoActive}),F=(0,r.useMemo)((function(){return o().createElement(tt,{functionalItemNoActiveText:E?Qe.FunctionalIndoorLocationNoActive:Qe.FunctionalIndoorLocationNoActiveDis})}),[E]);return o().createElement("div",{className:w["routing-editing-function-area"]},o().createElement("div",{className:w["routing-editing-function-area__group"]},o().createElement(We,{content:x,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(v===we.Ay.RELOCATE?w["custom-popover-functinal"]:w["custom-popover-ordinary"])},o().createElement("div",{className:C(ht({},w["func-relocate-ele"],g))},o().createElement(Xe,{functionalName:we.Ay.RELOCATE,checkedItem:v,onClick:k(we.Ay.RELOCATE),disable:g}))),o().createElement(We,{content:I,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(v===we.Ay.WAYPOINT?w["custom-popover-functinal"]:w["custom-popover-ordinary"])},o().createElement("div",null,o().createElement(Xe,{functionalName:we.Ay.WAYPOINT,checkedItem:v,onClick:k(we.Ay.WAYPOINT)}))),o().createElement(We,{content:F,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(v===we.Ay.INDOOR_LOCALIZATION?w["custom-popover-functinal"]:w["custom-popover-ordinary"])},o().createElement("div",null,o().createElement(Xe,{functionalName:we.Ay.INDOOR_LOCALIZATION,checkedItem:v,onClick:k(we.Ay.INDOOR_LOCALIZATION),disable:!E}))),o().createElement(We,{content:j,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(v===we.Ay.LOOP?w["custom-popover-functinal"]:w["custom-popover-ordinary"])},o().createElement("div",null,o().createElement(Xe,{functionalName:we.Ay.LOOP,checkedItem:v,onClick:k(we.Ay.LOOP)})))),o().createElement(We,{content:R,trigger:"hover",placement:"rightTop",destroyTooltipOnHide:!0,rootClassName:C(v===we.Ay.FAVORITE?w["custom-popover-functinal"]:w["custom-popover-ordinary"])},o().createElement("div",null,o().createElement(Xe,{functionalName:we.Ay.FAVORITE,checkedItem:v,onClick:k(we.Ay.FAVORITE)}))))}const Ct=o().memo(wt),St=(0,Y.makeStyles)((function(e){return{"routing-editing-op-con":{"& > button:nth-of-type(1)":{width:"72px",height:"32px",marginRight:"16px",backgroundColor:e.components.routingEditing.backgroundColor,border:e.components.routingEditing.border,color:e.components.routingEditing.color,"&:hover":{color:e.components.routingEditing.hoverColor,backgroundColor:e.components.routingEditing.backgroundHoverColor,border:e.components.routingEditing.borderHover},"&:active":{color:e.components.routingEditing.activeColor,backgroundColor:e.components.routingEditing.backgroundActiveColor,border:e.components.routingEditing.borderActive}},"& > button:nth-of-type(2)":{width:"114px",height:"32px"}}}}));function Pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function At(){var e,t,n=(0,Ce.ml)(),r=v(),a=St(),l=a.classes,u=(a.cx,(0,I.d)()),c=(0,N.A)().mainApi,s=(e=Ee(),t=1,function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Pt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],f=s.routingEditor,m=s.routeManager,p=(0,h.Bd)("routeEditing").t;return o().createElement("div",{className:l["routing-editing-op-con"]},o().createElement(i.$n,{ghost:!0,onClick:function(){i.aF.confirm({content:p("cancelEditingRouting"),icon:o().createElement("span",null),onOk:function(){r("/"),u.exitFullScreen()},okText:p("modalConfirmYes"),cancelText:p("modalConfirmNo")})}},p("cancel")),o().createElement(i.$n,{onClick:function(){var e,t=u.panelId,o=f.initiationMarker.initiationMarkerPosition,i={initialPoint:o,wayPoint:f.pathwayMarker.pathWatMarkerPosition,cycleNumber:null===(e=m.currentRouteMix.getCurrentRouteMix().currentRouteLoop)||void 0===e?void 0:e.currentRouteLoopTimes};o||c.getStartPoint().then((function(e){i.initialPoint=e})),m.currentRouteMix.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!0}}),n.emit(re.u.SimControlRoute,{panelId:t,routeInfo:i}),r("/"),u.exitFullScreen()}},p("saveEditing")))}function kt(e){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kt(e)}function xt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function It(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xt(Object(n),!0).forEach((function(t){Nt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Nt(e,t,n){return(t=function(e){var t=function(e){if("object"!=kt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=kt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==kt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function jt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Rt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Ft(){var e=(0,h.Bd)("routeEditing").t,t=jt(Ee(),2),n=t[0].routeManager,a=t[1],l=n.currentRouteManager,u=(0,I.d)().registerFullScreenHooks,c=(0,N.A)(),s=c.mainApi,f=c.isMainConnected,m=jt((0,w.f)(),2),p=m[0],d=m[1],y=jt((0,r.useState)((function(){return new Re.A})),1)[0],g=jt((0,r.useState)(null),2),E=g[0],O=g[1],C=function(e){E!==e&&O(e)},P=(0,S.A)().classes,A=jt((0,b.qZ)(),1)[0],k=v();(0,r.useEffect)((function(){u({afterExitFullScreen:function(){k("/")}})}),[]),(0,r.useEffect)((function(){p.init(),p.view.changeViewType(Le.MAP,!1),a({type:ye,payload:{routingEditor:p}})}),[]);var x=(0,r.useCallback)((function(e){var t,n;null==s||s.getMapElementIds({point:{x:null!==(t=e.x)&&void 0!==t?t:0,y:null!==(n=e.y)&&void 0!==n?n:0},radius:200}).then((function(e){if(!Re.A.isMapElementIdsEmpty(e)){var t=jt(y.getMapElement(e),2),n=(t[0],t[1]);s.getMapElementsByIds(n).then((function(e){y.updateMapElement(e),null==p||p.updateMap(y.getAllMapElements()),p.render()}))}}))}),[f]);return(0,r.useEffect)((function(){var e;p.removeAll(),p.deactiveAll(),y.clear();var t=function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];p.coordinates.initialize(t.x,t.y),r&&p.initiationMarker.init(t),x(new Fe.Vector3(t.x,t.y,0)),e=n.currentRouteManager.subScribeCurrentRoute((function(e){var t=e.routeOrigin,n=e.routePoint;if(t===me.CREATING_ROUTE){var r=n.routeInitialPoint,o=n.routeWayPoint;p.initiationMarker.init(r),p.pathwayMarker.init(o)}}))};return null==s||s.getMapElementIds({radius:20}).then((function(e){var n=jt(y.getMapElement(e),2),r=(n[0],n[1]);s.getMapElementsByIds(r).then((function(e){if(y.updateMapElement(e),Re.A.findFirstMapElement(r))try{null==p||p.updateMap(e),p.render(),p.setCameraUpdateCallback(x),null==s||s.getStartPoint().then((function(e){t(e)})).catch((function(){s.getVirtualStartPoint().then((function(e){t(e,!1)}))}))}catch(e){console.error("getMapElementById error",e)}}))})),function(){var t;null===(t=e)||void 0===t||t.unsubscribe()}}),[f,A.currentMap]),(0,r.useEffect)((function(){var t=l.subScribeCurrentCheckPoint((function(t){if(f){var n=t,r=t.type;delete n.type,s.checkRoutingPoint({point:It(It({},n),{},{id:0})}).then((function(t){t.isLegal?r===pe.INITIAL_POINT&&s.setStartPoint({point:It({},n)}):(r===pe.INITIAL_POINT&&(p.initiationMarker.undo(),(0,i.iU)({type:"error",content:e("checkStartPointTooltip")})),r===pe.WAY_POINT&&(p.pathwayMarker.undo(),(0,i.iU)({type:"error",content:e("checkPointTooltip")})))}))}}));return function(){t.unsubscribe()}}),[f]),o().createElement("div",{className:P["viz-container"]},o().createElement("div",{id:d,className:P["web-gl"]}),o().createElement(Ct,{carviz:p,activeName:E,changeActiveName:C}),o().createElement("div",{className:P["view-btn-container"]},o().createElement(W.A,{from:"RoutingEditing",carviz:p,activeName:E,changeActiveName:C})),o().createElement("div",{className:P["view-ope-container"]},o().createElement(At,null)))}var Lt=n(74633),Tt=n(23110);function Mt(e){return Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mt(e)}function Vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Dt(r.key),r)}}function Dt(e){var t=function(e){if("object"!=Mt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Mt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Mt(t)?t:t+""}var _t=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentRouteSubject=new Lt.t(t),this.currentCheckPointSubject=new Tt.B},(t=[{key:"getCurrentRoute",value:function(){return this.currentRouteSubject.value}},{key:"setCurrentRoute",value:function(e){this.currentRouteSubject.next(e)}},{key:"subScribeCurrentRoute",value:function(e){return this.currentRouteSubject.subscribe(e)}},{key:"setScribeCurrentCheckPoint",value:function(e){this.currentCheckPointSubject.next(e)}},{key:"subScribeCurrentCheckPoint",value:function(e){return this.currentCheckPointSubject.subscribe(e)}}])&&Vt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function zt(e){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zt(e)}function Bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Kt(r.key),r)}}function Kt(e){var t=function(e){if("object"!=zt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=zt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==zt(t)?t:t+""}var Wt=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentRouteLoop=t.currentRouteLoop},(t=[{key:"getCurrentRouteMix",value:function(){return{currentRouteLoop:this.currentRouteLoop}}},{key:"setCurrentRouteMix",value:function(e){e.currentRouteLoop&&(this.currentRouteLoop=e.currentRouteLoop)}}])&&Bt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Ut(e){return Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ut(e)}function Ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Zt(r.key),r)}}function Yt(e,t,n){return t&&Ht(e.prototype,t),n&&Ht(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Zt(e){var t=function(e){if("object"!=Ut(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ut(t)?t:t+""}var $t=Yt((function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentRouteManager=new _t(t),this.currentRouteMix=new Wt(n)}));function Gt(e){return Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gt(e)}function qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qt(Object(n),!0).forEach((function(t){Xt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xt(e,t,n){return(t=function(e){var t=function(e){if("object"!=Gt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Gt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Gt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return en(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?en(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function en(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function tn(){var e,t,n,a,l,u,c,s,f,p=(0,S.A)().classes,d=Qt((0,b.qZ)(),1)[0],v=(0,r.useRef)(-1),y=(0,I.d)(),E=(0,r.useContext)(m),P=Qt((0,w.A)(),2),j=P[0],L=P[1],T=(0,r.useRef)([0,0]),M=Qt((0,C.Vc)(C.qK.CurrentSwitchView,"Default"),2),V=M[0],D=M[1],_=(0,N.A)(),z=_.mainApi,U=_.streamApi,H=_.isMainConnected,Y=y.logger,Z=y.panelId,$=y.subscribeToData,G=y.updateChannel,q=y.setKeyDownHandlers,J=y.removeKeyDownHandlers,X=(0,h.Bd)("panels").t,Q=Qt((0,r.useState)(x().Perception.pointCloud.currentVisible),2),ee=Q[0],te=Q[1],ne=Qt((0,r.useState)(null===(e=x().Perception.curbPointCloud)||void 0===e?void 0:e.currentVisible),2),re=ne[0],oe=ne[1],ie=Qt((0,r.useState)(null),2),ae=ie[0],le=ie[1],ue=Qt((0,r.useState)(null),2),ce=ue[0],se=ue[1],fe=Qt((0,r.useState)(null!==(t=null===(n=x().Map.boudingBox)||void 0===n?void 0:n.currentVisible)&&void 0!==t&&t),2),me=fe[0],pe=fe[1],de=Qt((0,r.useState)(null!==(a=null===(l=x().Planning.planningBoundaryLine)||void 0===l?void 0:l.currentVisible)&&void 0!==a&&a),2),ve=de[0],ye=de[1],be=Qt((0,r.useState)(null!==(u=null===(c=x().Planning.planningReferenceLine)||void 0===c?void 0:c.currentVisible)&&void 0!==u&&u),2),ge=be[0],he=be[1],Ee=Qt((0,r.useState)(null!==(s=null===(f=x().Planning.planningTrajectoryLine)||void 0===f?void 0:f.currentVisible)&&void 0!==s&&s),2),Oe=Ee[0],we=Ee[1],Ce=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pointCloud";"pointCloud"===t&&le(e),"curbPointCloud"===t&&se(e)},Se=(0,r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pointCloud";return"pointCloud"===e?ae:"curbPointCloud"===e?ce:void 0}),[ae,ce]),Pe=(0,r.useMemo)((function(){return d.currentOperation===b.D8.WAYPOINT_FOLLOW?Te.FOLLOW:Te.DEFAULT}),[d.currentOperation]),Ae=Qt((0,r.useState)(Pe),2),ke=Ae[0],xe=Ae[1],Ie=(0,r.useRef)(),Ne=(0,r.useRef)({}),Re=(0,r.useRef)(null),Fe=(0,r.useRef)(null),Le=Qt((0,r.useState)(0),2),Me=Le[0],Ve=Le[1],De=Qt((0,r.useState)(0),2),_e=De[0],ze=De[1],Be=0,Ke=performance.now(),We=Qt((0,r.useState)(0),2),Ue=(We[0],We[1]),He=Qt((0,r.useState)(!0),2),Ye=He[0],Ze=He[1],$e=function(){!function(){if(Ye){var e=performance.now();Be++,e-Ke>=1e3&&(Ve(Be),Be=0,Ke=e),ze(null==j?void 0:j.renderer.info.render.triangles)}}(),null==j||j.render(),Ie.current&&cancelIdleCallback(Ie.current),Ie.current=requestIdleCallback((function(){$e()}),{timeout:1e3})},Ge=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pointCloud";"pointCloud"===t?null!=Re&&Re.current&&Re.current.unsubscribe():"curbPointCloud"===t&&null!=Fe&&Fe.current&&Fe.current.unsubscribe(),null!==(e=Ne.current[t])&&void 0!==e&&e.subscription&&(Ne.current[t].subscription.unsubscribe(),Ne.current[t]=null),null==j||j.updateData({object:[],autoDrivingCar:{}}),null==j||j.render()};(0,r.useEffect)((function(){xe(Pe)}),[Pe]),(0,r.useEffect)((function(){j.init();var e=x();k.set(e),j.option.updateLayerOption(A(e),"vehicle"),e.Perception.pointCloud.currentVisible&&setTimeout((function(){G({name:g.lt.POINT_CLOUD,needChannel:!1})}),0)}),[]),(0,r.useEffect)((function(){var e=[{keys:["="],functionalKey:"ctrlKey",handler:function(e){var t;e.preventDefault(),null===(t=j.view)||void 0===t||t.updateViewDistance(-10)},discriptor:X("zoomIn")},{keys:["="],functionalKey:"metaKey",handler:function(e){var t;e.preventDefault(),null===(t=j.view)||void 0===t||t.updateViewDistance(-10)},discriptor:X("zoomIn")},{keys:["-"],functionalKey:"ctrlKey",handler:function(e){var t;e.preventDefault(),null===(t=j.view)||void 0===t||t.updateViewDistance(10)},discriptor:X("zoomOut")},{keys:["-"],functionalKey:"metaKey",handler:function(e){var t;e.preventDefault(),null===(t=j.view)||void 0===t||t.updateViewDistance(10)},discriptor:X("zoomOut")}];return q(e),function(){J(e)}}),[X]);var qe=function(e){var t,n,r,o=Jt(Jt({},e),{},{boudingBox:!!me}),i=null,a=(null==o||null===(t=o.planningData)||void 0===t?void 0:t.path)||[];return Array.isArray(null==o||null===(n=o.planningData)||void 0===n?void 0:n.path)?(ve||(i=["planning_path_boundary_1_regular/self","candidate_path_regular/self","planning_path_boundary_2_regular/self","planning_path_boundary_1_fallback/self","candidate_path_fallback/self","planning_path_boundary_2_fallback/self"],o.planningData.path=a.filter((function(e){return!i.includes(e.name)}))),a=(null==o||null===(r=o.planningData)||void 0===r?void 0:r.path)||[],ge||(i=["planning_reference_line"],o.planningData.path=a.filter((function(e){return!i.includes(e.name)}))),!Oe&&o.planningTrajectory&&(o.planningTrajectory=[]),o):o};(0,r.useEffect)((function(){if(H){if("/"!==E.currentPath)return function(){return null};var e=null,t=null;if(ke===Te.FOLLOW){j.removeAll(),j.view.setViewType("Overhead");var n=$({name:g.lt.SIM_WORLD,needChannel:!1});n&&(t=n.subscribe((function(e){if(e&&0!==Object.keys(e).length){var t={autoDrivingCar:e.autoDrivingCar,followPlanningData:e.planningTrajectory};j.updateData(t)}})))}if(ke===Te.DEFAULT){j.follow.dispose();var r=O()((function(e){z.getRoutePath().then((function(t){if(v.current=e.routingTime,0!==Object.keys(e).length){var n=Jt({},e);n.routePath=t.routePath,j.updateData(qe(n)),null==j||j.pointCloud.updateOffsetPosition()}}))}),500,{leading:!0}),o=$({name:g.lt.SIM_WORLD,needChannel:!1});o&&(t=o.subscribe((function(e){if(e){var t=e.autoDrivingCar;if(t){var n,o,i=null!==(n=t.positionX)&&void 0!==n?n:0,a=null!==(o=t.positionY)&&void 0!==o?o:0,l=Math.abs(T.current[0]-i)+Math.abs(T.current[1]-a);Y.debug("车辆偏移距离：".concat(l,", 阈值为100")),l>100&&0!==T.current[0]&&0!==T.current[1]&&j&&j.initialized&&(Y.debug("车辆偏移距离超过阈值，重置场景"),j.resetScence()),T.current=[i,a]}0!==Object.keys(e).length&&(e.routingTime&&e.routingTime!==v.current?r(e):(j.updateData(qe(e)),null==j||j.pointCloud.updateOffsetPosition()))}})));var i=$({name:g.lt.Map,needChannel:!1});i&&(e=i.subscribe((function(e){e&&(null==j||j.updateMap(e))})))}return function(){ke===Te.FOLLOW&&(j.view.setViewType("Default"),t&&t.unsubscribe()),ke===Te.DEFAULT&&(e&&e.unsubscribe(),t&&t.unsubscribe())}}}),[ke,H,ge,ve,Oe,me,E.currentPath]),(0,r.useEffect)((function(){return"/"===E.currentPath&&$e(),function(){var e=Ie.current;e&&cancelIdleCallback(e)}}),[E.currentPath]);var Je=(0,N.A)().metadata,Xe=(0,r.useMemo)((function(){return Je.find((function(e){return e.dataName===g.lt.POINT_CLOUD}))}),[Je,H]),Qe=(0,r.useMemo)((function(){return Xe?Xe.channels.map((function(e){return{label:null==e?void 0:e.channelName,value:null==e?void 0:e.channelName}})):[]}),[Xe]),et=(0,r.useMemo)((function(){var e,t=null===(e=Je.find((function(e){return e.dataName===g.lt.POINT_CLOUD})))||void 0===e||null===(e=e.channels)||void 0===e?void 0:e.filter((function(e){return(null==e?void 0:e.channelName.includes("compensator"))||(null==e?void 0:e.channelName.includes("fusion"))})).sort((function(e){return null!=e&&e.channelName.includes("compensator")?-1:1}));return Array.isArray(t)?t[0]:""}),[Je]),tt=(0,C.Mj)(R(Z)),nt=(0,C.Mj)(F(Z));(0,r.useEffect)((function(){var e=null;if(H){var t=tt.get();ee&&t&&(e=$({name:g.lt.POINT_CLOUD,channel:t,needChannel:!0}))&&(Re.current=e.subscribe((function(e){e&&(null==j||j.updatePointCloud(e))})),Ce(t,"pointCloud"))}return function(){Re.current&&Re.current.unsubscribe(),j.pointCloud.disposeLastFrame()}}),[Je,ee,H]),(0,r.useEffect)((function(){var e=null;if(H){var t=nt.get()||"/apollo/perception/edge";re&&(e=$({name:g.lt.POINT_CLOUD,channel:t,needChannel:!0}))&&(Fe.current=e.subscribe((function(e){e&&(null==j||j.updateCurbPointCloud(e))})),Ce(t,"curbPointCloud"))}return function(){Fe.current&&Fe.current.unsubscribe(),j.curbPointCloud.disposeLastFrame()}}),[Je,re,H]),(0,r.useEffect)((function(){return function(){Object.keys(Ne.current).forEach((function(e){var t;null!==(t=Ne.current[e])&&void 0!==t&&t.subscription&&Ne.current[e].subscription.unsubscribe()}))}}),[]);var rt=o().createElement(B,{carviz:j,pointCloudFusionChannel:et,handlePointCloudVisible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pointCloud";"pointCloud"===t&&te(e),"curbPointCloud"===t&&oe(e)},getCurChannel:Se,setCurChannel:Ce,pointcloudChannels:Qe,updatePointcloudChannel:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pointCloud";Ge();var n=U.subscribeToDataWithChannel(g.lt.POINT_CLOUD,e).subscribe((function(e){e&&(null==j||j.updatePointCloud(e))}));Ne.current[t]={name:g.lt.POINT_CLOUD,channel:e,subscription:n}},closeChannel:Ge,handleReferenceLineVisible:he,handleBoundaryLineVisible:ye,handleTrajectoryLineVisible:we,handleBoudingBoxVisible:pe});return o().createElement("div",{className:p["viz-container"]},o().createElement("div",{id:L,className:p["web-gl"]}),o().createElement("div",{className:p["viz-rend-fps-item-hide"],onClick:function(){Ue((function(e){var t=e+1;return 5===t?(Ze(!Ye),console.log("change fps text visible : ".concat(Ye)),0):t}))}}),!Ye&&o().createElement("div",{className:p["viz-rend-fps-item"]},o().createElement("header",{className:"FPS-display"},o().createElement("p",null,"fps: ",Me,"   triangles: ",_e))),o().createElement("div",{className:p["viz-btn-container"]},o().createElement(W.A,{from:"VehicleViz",carviz:j},o().createElement(i.AM,{placement:"leftTop",content:rt,trigger:"click"},o().createElement("span",{className:p["viz-btn-item"]},o().createElement(i.Av,{name:"IcCoverageHover"}))),o().createElement(i.AM,{overlayClassName:p["layer-menu-popover"],placement:"leftBottom",content:o().createElement(K.A,{carviz:j,setCurrentView:D}),trigger:"click",style:{padding:"0 !importent"}},o().createElement("span",{className:p["viz-btn-item"]},null==V?void 0:V.charAt(0))))),o().createElement(je,null))}function nn(){var e=Qt(Ee(),2)[1],t={routeOrigin:me.EDITING_ROUTE,routePoint:{routeInitialPoint:null,routeWayPoint:[]}},n={currentRouteLoop:{currentRouteLoopState:!0}};return(0,r.useEffect)((function(){var r;e((r={routeManager:new $t(t,n)},{type:be,payload:r}))}),[]),o().createElement(p,{initialPath:"/"},o().createElement(y,{path:"/",style:{minWidth:"244px",height:"100%",position:"relative"}},o().createElement(tn,null)),o().createElement(d,{path:"/routing",style:{width:"100%",height:"100%"}},o().createElement(Ft,null)))}function rn(){return o().createElement(he,null,o().createElement(nn,null))}function on(e){var t=(0,r.useMemo)((function(){return(0,U.A)({PanelComponent:rn,panelId:e.panelId})}),[]);return o().createElement(t,e)}rn.displayName="VehicleViz";const an=o().memo(on)}}]);