syntax = "proto2";

package apollo.planning_internal;

import "modules/canbus/proto/chassis.proto";
import "modules/common/proto/header.proto";
import "modules/common/proto/error_code.proto";
import "modules/common/proto/path_point.proto";
import "modules/localization/proto/localization.proto";
import "modules/localization/proto/pose.proto";
import "modules/map/proto/routing.proto";
import "modules/perception/proto/perception_obstacle.proto";
import "modules/planning/proto/decision.proto";
import "modules/prediction/proto/prediction_obstacle.proto";

message PlanningObstacle {
  optional int32 perception_id = 1;
  optional string decision_id = 2;

  optional apollo.perception.Point position =
      3;  // obstacle position in the world coordinate system.
  optional double theta = 4;  // heading in the world coordinate system
  optional apollo.perception.Point velocity = 5;  // obstacle velocity.
  // obstacle speed ( == sqrt(velocity.x^2 + velocity.y^2)
  optional double speed = 6;

  // Size of obstacle bounding box.
  optional double length = 7;  // obstacle length.
  optional double width = 8;   // obstacle width.
  optional double height = 9;  // obstacle height.

  // obstacle corner points.
  repeated apollo.perception.Point polygon_point = 10;
  // duration of an obstacle since detection.
  optional double tracking_time = 11;

  // perception timestamp in ms
  optional double perception_timestamp = 12;
  // object type in perception
  optional apollo.perception.PerceptionObstacle.Type perception_object_type =
      13;

  optional double prediction_timestamp = 14;  // prediction_timestamp in ms
  // from prediction
  repeated apollo.prediction.Trajectory prediction_trajectory = 15;

  optional apollo.planning.ObjectDecision.ObjectType decision_object_type = 16;
  optional apollo.planning.ObjectDecisionType object_decision =
      17 [deprecated = true];
  repeated apollo.planning.ObjectDecisionType planning_object_decision = 18;
}

message Debug {
  /*
      PLEASE add id here
      id = 1: st_graph_info
  */
  message DebugMessage {
    optional apollo.common.ErrorCode error_code = 1;
    optional int32 id = 2;
    oneof debug_string {
      string trace = 3;
      string info = 4;
      string warn = 5;
      string error = 6;
      string fatal = 7;
    }
  }

  optional apollo.common.ErrorCode error_code = 1;
  optional PlanningData planning_data = 2;
  repeated DebugMessage debug_message = 3;
}

message LightSignal {
  optional bool emergency = 1; // hazard signal
  enum TurnSignal {
    NO_TURN = 1;
    LEFT_TURN = 2;
    RIGHT_TURN = 3;
  };
  optional TurnSignal turn_signal = 2 [default = NO_TURN];
}

message SpeedPlan {
  optional string name = 1;
  repeated apollo.common.SpeedPoint speed_point = 2;
}

// next id: 14
message PlanningData {
  optional apollo.common.Header header = 1;

  // input
  optional apollo.localization.LocalizationEstimate adc_position = 7;
  optional apollo.canbus.Chassis chassis = 8;
  optional apollo.hdmap.RoutingResult routing = 9;
  optional apollo.common.TrajectoryPoint init_point = 10;
  optional bool is_replan = 11;

  // processed planning_obstacles
  repeated PlanningObstacle planning_obstacle = 4;

  repeated apollo.common.Path path = 6;
  repeated SpeedPlan speed_plan = 13;

  optional apollo.localization.Pose init_status = 2 [deprecated = true];  // initial status of adc
  optional apollo.planning.MainDecision main_decision = 3 [deprecated = true];
  optional LightSignal light_signal = 5 [deprecated = true];
}
