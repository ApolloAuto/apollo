syntax = "proto2";

package apollo.perception.lidar;

message MlfDistanceWeight {
  optional string sensor_name_pair = 1 [default = ""];

  optional float location_dist_weight = 2 [default = 0];
  optional float direction_dist_weight = 3 [default = 0];
  optional float bbox_size_dist_weight = 4 [default = 0];
  optional float point_num_dist_weight = 5 [default = 0];
  optional float histogram_dist_weight = 6 [default = 0];
  optional float centroid_shift_dist_weight = 7 [default = 0];
  optional float bbox_iou_dist_weight = 8 [default = 0];
  optional float semantic_map_dist_weight = 9 [default = 0];
}

message MlfDistanceConfig {
  repeated MlfDistanceWeight foreground_weights = 1;
  repeated MlfDistanceWeight background_weights = 2;
  optional float euclidean_distance_threshold = 3 [default = 2.0];
  optional float out_gate_match_cost = 4 [default = 5.0];
}

message MlfTrackObjectMatcherConfig {
  optional string foreground_mathcer_method = 1
      [default = "MultiHmBipartiteGraphMatcher"];
  optional string background_matcher_method = 2
      [default = "GnnBipartiteGraphMatcher"];
  optional float bound_value = 3 [default = 100.0];
  optional float max_match_distance = 4 [default = 4.0];
}

message MlfTrackerConfig {
  repeated string filter_name = 1;
}

message MlfMotionFilterConfig {
  optional bool use_adaptive = 1 [default = true];
  optional bool use_breakdown = 2 [default = true];
  optional bool use_convergence_boostup = 3 [default = true];

  optional double init_velocity_variance = 4 [default = 5.0];
  optional double init_acceleration_variance = 5 [default = 10.0];
  optional double measured_velocity_variance = 6 [default = 0.4];
  optional double predict_variance_per_sqrsec = 7 [default = 10.0];

  optional uint32 boostup_history_size_minimum = 8 [default = 3];
  optional uint32 boostup_history_size_maximum = 9 [default = 6];
  optional double converged_confidence_minimum = 10 [default = 0.5];
  optional double noise_maximum = 12 [default = 0.1];

  optional double trust_orientation_range = 13 [default = 40];
}

message MlfMotionRefinerConfig {
  optional double claping_acceleration_threshold = 1 [default = 10];
  optional double claping_speed_threshold = 2 [default = 1.0];
  optional double cyc_refine_speed = 3 [default = 1.2];
  optional double car_refine_speed = 4 [default = 1.0];
  optional bool use_movable_state_check = 5 [default = false];
}

message MlfShapeFilterConfig {
  optional double bottom_points_ignore_threshold = 1 [default = 0.1];
  optional double top_points_ignore_threshold = 2 [default = 1.6];
}

message MlfTypeFilterConfig {
  optional double temporal_window = 1 [default = 20.0];
  optional bool enable_temporal_fusion = 2 [default = true];
  optional string one_shot_fusion_method = 3 [default = "CCRFOneShotTypeFusion"];
  optional string sequence_fusion_method = 4 [default = "CCRFSequenceTypeFusion"];
  optional bool use_tracked_objects = 5 [default = true];
  optional bool print_type_filter_log = 6 [default = false];
}

message MlfDirectionFilterConfig {
  optional double init_direction_variance = 1 [default=25.0];
  optional double variance_bound = 2 [default=25.0];
  optional double max_angular_thresh = 3 [default=50.0];
  optional double converged_confidence_minimum = 4 [default=0.6];
  optional double angular_scale = 5 [default=0.8];
  optional uint32 angular_window_size = 6 [default=5];
  optional double predict_noise_per_sqrsec = 7 [default=100.0];
  optional double angular_confidence_thresh = 8 [default=0.7];
}

message MlfEngineConfig {
  optional bool use_histogram_for_match = 1 [default = true];
  optional uint32 histogram_bin_size = 2 [default = 10];
  optional bool output_predict_objects = 3 [default = false];
  optional double reserved_invisible_time = 4 [default = 0.2];
  optional bool use_frame_timestamp = 5 [default = false];
  optional bool set_static_outside_hdmap = 6 [default = false];
  optional bool print_debug_log = 7 [default = false];
  optional double delay_time_output = 8 [default = 0.25];
  optional uint32 pub_track_times = 9 [default = 1];
  optional bool merge_foreground_background = 10 [default = false];
}
